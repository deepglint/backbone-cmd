#Vulcand 使用方法

##说明

Vulcand是一个服务代理的服务，用来做HTTP的转发，并且支持多种中间件对请求进行不同的处理。

###Host



###Listener

Listener指的是监听Vulcand的监听端口

通常以```l_name```来进行命名

参数说明

```
NAME:
   upsert - Update or insert a listener

USAGE:
   command upsert [command options] [arguments...]

OPTIONS:
   --id              id
   --proto              protocol, either http or https
   --net 'tcp'             network, tcp or unix
   --addr 'tcp'               address to bind to, e.g. 'localhost:31000'
   --scope              scope expression limits the listener, e.g. 'Hostname(`myhost`)'
   --tlsSkipVerify            insecure: skip certificate verification
   --tlsPreferServerCS           prefer server cipher suites, recommended on for listener settings
   --tlsSessionTicketsOff        turns off TLS session tickets
   --tlsMinV               minimum supported TLS version
   --tlsMaxV               maximum supported TLS version
   --tlsSessionCache             session cache type
   --tlsSessionCacheCapacity '0'    session cache capacity
   --tlsCS '--tlsCS option --tlsCS option'   optional list of preferred cipher suites
   
```

添加一个HTTPS的Listener

```
vctl listener upsert --id ls4 --proto=https --net=tcp -addr=127.0.0.1:9443 --tlsSkipVerify --tlsSessionTicketsOff --tlsMinV=VersionTLS10 --tlsMaxV=VersionTLS11 --tlsPreferServerCS

```
参考文档参见[Vulcand listener](https://vulcand.io/api.html#upsert-listener)

###Frontend

以```f_name```来进行命名

参数说明

```
NAME:
   upsert - Update or insert a frontend

USAGE:
   command upsert [command options] [arguments...]

OPTIONS:
   --id     id, autogenerated if empty
   --route     roue, will be matched against request's path
   --ttl '0'      time to live duration, persistent if omitted
   --backend, -b  backend id
   --maxMemBodyKB '0'   maximum request size to cache in memory, in KB
   --maxBodyKB '0'   maximum request size to allow for a frontend, in KB
   --failoverPredicate  predicate that defines cases when failover is allowed
   --forwardHost  hostname to set when forwarding a request
   --trustForwardHeader allows copying X-Forwarded-For header value from the original request
   -b 
```
添加一个Frontend

```
vctl frontend upsert --id f_aws_slices --route 'PathRegexp("/aws/api/slices.*")' -b b_aws_slices

```

###Backend

###Service

###LoginAuth

###Connlimit

##配置Vulcand

###通过Vctl进行配置

###


###通过Curl

##SensorConfig

```
#!/bin/bash

curl -X POST -H "Content-Type: application/json" http://127.0.0.1:8182/v2/backends -d '{"Backend": {"Id":"b_libracontent", "Type":"http"}}'

curl -X POST -H "Content-Type: application/json" http://127.0.0.1:8182/v2/backends -d '{"Backend": {"Id":"b_libracontent", "Type":"http"}}'

curl -X POST -H "Content-Type: application/json" http://127.0.0.1:8182/v2/backends/b_libracontent/servers -d '{"Server": {"Id":"srv_libracontent_1", "URL":"http://127.0.0.1:1357"}}'

curl -X POST -H "Content-Type: application/json" http://127.0.0.1:8182/v2/frontends -d '{"Frontend": {"Id":"f_libracontent", "Type": "http", "BackendId": "b_libracontent", "Route": "PathRegexp(\"/api/libracontent.*\")"}}'

curl -X POST -H "Content-Type: application/json" http://127.0.0.1:8182/v2/frontends/f_libracontent/middlewares -d '{"Middleware": {"Id":"r_libracontent","Priority":6,"Type":"rewrite","Middleware":{"Regexp":"/api/libracontent(.*)","Replacement":"/api$1","RewriteBody":false,"Redirect":false}}}'

curl -X POST -H "Content-Type: application/json" http://localhost:8182/v2/frontends/f_libracontent/middlewares -d '{"Middleware": {"Priority": 2,"Type": "ratelimit","Id": "rl_libracontent","Middleware":{"Requests":1,"PeriodSeconds":1,"Burst":3,"Variable": "client.ip"}}}'

curl -X POST -H "Content-Type: application/json" http://localhost:8182/v2/frontends/f_libracontent/middlewares -d '{"Middleware": {"Id": "cl_libracontent", "Priority": 1, "Type": "connlimit", "Middleware":{"Connections":16, "Variable": "client.ip"}}}'

curl -X POST -H "Content-Type: application/json" http://127.0.0.1:8182/v2/frontends/f_libracontent/middlewares  -d '{"Middleware":{"Id":"lga_libracontent","Priority":4,"Type":"loginauth","Middleware":{"Etcdaddr":"http://127.0.0.1:4001","Etcdlistenaddr":"http://127.0.0.1:4001"}}}'

###### maintain

curl -X POST -H "Content-Type: application/json" http://127.0.0.1:8182/v2/backends -d '{"Backend": {"Id":"b_maintain", "Type":"http"}}'

curl -X POST -H "Content-Type: application/json" http://127.0.0.1:8182/v2/backends/b_maintain/servers -d '{"Server": {"Id":"srv_maintain_1", "URL":"http://127.0.0.1:8008"}}'

curl -X POST -H "Content-Type: application/json" http://127.0.0.1:8182/v2/frontends -d '{"Frontend": {"Id":"f_maintain", "Type": "http", "BackendId": "b_maintain", "Route": "PathRegexp(\"/api/maintain.*\")"}}'

curl -X POST -H "Content-Type: application/json" http://127.0.0.1:8182/v2/frontends/f_maintain/middlewares -d '{"Middleware": {"Id":"r_maintain","Priority":6,"Type":"rewrite","Middleware":{"Regexp":"/api/maintain(.*)","Replacement":"/api$1","RewriteBody":false,"Redirect":false}}}'

curl -X POST -H "Content-Type: application/json" http://localhost:8182/v2/frontends/f_maintain/middlewares -d '{"Middleware": {"Priority": 2,"Type": "ratelimit","Id": "rl_maintain","Middleware":{"Requests":1,"PeriodSeconds":1,"Burst":3,"Variable": "client.ip"}}}'

curl -X POST -H "Content-Type: application/json" http://localhost:8182/v2/frontends/f_maintain/middlewares -d '{"Middleware": {"Id": "cl_maintain", "Priority": 1, "Type": "connlimit", "Middleware":{"Connections":16, "Variable": "client.ip"}}}'

curl -X POST -H "Content-Type: application/json" http://127.0.0.1:8182/v2/frontends/f_maintain/middlewares  -d '{"Middleware":{"Id":"lga_maintain","Priority":4,"Type":"loginauth","Middleware":{"Etcdaddr":"http://127.0.0.1:4001","Etcdlistenaddr":"http://127.0.0.1:4001"}}}'

###### bumble
 curl -X POST -H "Content-Type: application/json" http://127.0.0.1:8182/v2/backends  -d '{"Backend": {"Id":"b_bumble", "Type":"http"}}'

curl -X POST -H "Content-Type: application/json" http://127.0.0.1:8182/v2/backends/b_bumble/servers  -d '{"Server": {"Id":"srv_bumble", "URL":"http://127.0.0.1:8008"}}'

curl -X POST -H "Content-Type: application/json" http://127.0.0.1:8182/v2/frontends  -d '{"Frontend": {"Id":"f_bumble", "Type": "http", "BackendId": "b_bumble", "Route": "PathRegexp(\"/api/bumble.*\")"}}'

curl -X POST -H "Content-Type: application/json" http://127.0.0.1:8182/v2/frontends/f_bumble/middlewares  -d '{"Middleware": {"Id":"r_bumble","Priority":1,"Type":"rewrite","Middleware":{"Regexp":"/api/bumble(.*)","Replacement":"/api$1","RewriteBody":false,"Redirect":false}}}'

###### fiddle
 curl -X POST -H "Content-Type: application/json" http://127.0.0.1:8182/v2/backends  -d '{"Backend": {"Id":"b_fiddle", "Type":"http"}}'

curl -X POST -H "Content-Type: application/json" http://127.0.0.1:8182/v2/backends/b_fiddle/servers  -d '{"Server": {"Id":"srv_fiddle", "URL":"http://127.0.0.1:4001"}}'

curl -X POST -H "Content-Type: application/json" http://127.0.0.1:8182/v2/frontends  -d '{"Frontend": {"Id":"f_fiddle", "Type": "http", "BackendId": "b_fiddle", "Route": "PathRegexp(\"/api/fiddle.*\")"}}'

curl -X POST -H "Content-Type: application/json" http://127.0.0.1:8182/v2/frontends  -d '{"Frontend": {"Id":"f_fiddle_etcd", "Type": "http", "BackendId": "b_fiddle", "Route": "PathRegexp(\"/v2/keys/fiddle.*\")"}}'

curl -X POST -H "Content-Type: application/json" http://127.0.0.1:8182/v2/frontends/f_fiddle/middlewares  -d '{"Middleware": {"Id":"r_fiddle","Priority":1,"Type":"rewrite","Middleware":{"Regexp":"/api/fiddle(.*)","Replacement":"/v2/keys/fiddle$1","RewriteBody":false,"Redirect":false}}}'

```

